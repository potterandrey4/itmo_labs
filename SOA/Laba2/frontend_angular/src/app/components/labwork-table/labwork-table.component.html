<section>
    <h3 *ngIf="!groupByDiscipline">Лабораторные работы</h3>
    <h3 *ngIf="groupByDiscipline">Группировка по дисциплинам</h3>

    <ng-container *ngIf="groupByDiscipline; else flatTable">
        <ul>
            <li *ngFor="let item of (disciplineGroups | keyvalue)">
                {{ item.key }} — {{ item.value }} шт.
            </li>
        </ul>
    </ng-container>

    <ng-template #flatTable>
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z1" *ngIf="page && page.content">
            <!-- ID Column -->
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef class="sortable" (click)="toggleSort('id')">
                    ID
                    <span class="sort-indicator" *ngIf="getSortDirection('id')">
                        <mat-icon>{{ getSortDirection('id') === 'desc' ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
                        <span class="sort-index" *ngIf="sorts.length > 1">{{ getSortIndex('id') + 1 }}</span>
                    </span>
                </th>
                <td mat-cell *matCellDef="let lab">{{ lab.id }}</td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef class="sortable" (click)="toggleSort('name')">
                    Название
                    <span class="sort-indicator" *ngIf="getSortDirection('name')">
                        <mat-icon>{{ getSortDirection('name') === 'desc' ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
                        <span class="sort-index" *ngIf="sorts.length > 1">{{ getSortIndex('name') + 1 }}</span>
                    </span>
                </th>
                <td mat-cell *matCellDef="let lab">{{ lab.name }}</td>
            </ng-container>

            <!-- Difficulty Column -->
            <ng-container matColumnDef="difficulty">
                <th mat-header-cell *matHeaderCellDef class="sortable" (click)="toggleSort('difficulty')">
                    Сложность
                    <span class="sort-indicator" *ngIf="getSortDirection('difficulty')">
                        <mat-icon>{{ getSortDirection('difficulty') === 'desc' ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
                        <span class="sort-index" *ngIf="sorts.length > 1">{{ getSortIndex('difficulty') + 1 }}</span>
                    </span>
                </th>
                <td mat-cell *matCellDef="let lab">{{ getDifficultyLabel(lab) }}</td>
            </ng-container>

            <!-- Minimal point -->
            <ng-container matColumnDef="minimalPoint">
                <th mat-header-cell *matHeaderCellDef class="sortable" (click)="toggleSort('minimalpoint')">
                    Мин. балл
                    <span class="sort-indicator" *ngIf="getSortDirection('minimalpoint')">
                        <mat-icon>{{ getSortDirection('minimalpoint') === 'desc' ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
                        <span class="sort-index" *ngIf="sorts.length > 1">{{ getSortIndex('minimalpoint') + 1 }}</span>
                    </span>
                </th>
                <td mat-cell *matCellDef="let lab">{{ lab.minimalPoint }}</td>
            </ng-container>

            <!-- PQ Max -->
            <ng-container matColumnDef="personalQualitiesMaximum">
                <th mat-header-cell *matHeaderCellDef class="sortable" (click)="toggleSort('personalqualitiesmaximum')">
                    PQ Max
                    <span class="sort-indicator" *ngIf="getSortDirection('personalqualitiesmaximum')">
                        <mat-icon>{{ getSortDirection('personalqualitiesmaximum') === 'desc' ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
                        <span class="sort-index" *ngIf="sorts.length > 1">{{ getSortIndex('personalqualitiesmaximum') + 1 }}</span>
                    </span>
                </th>
                <td mat-cell *matCellDef="let lab">{{ lab.personalQualitiesMaximum || '—' }}</td>
            </ng-container>

            <!-- Coordinates -->
            <ng-container matColumnDef="coordinates">
                <th mat-header-cell *matHeaderCellDef>Координаты</th>
                <td mat-cell *matCellDef="let lab">{{ lab.coordinates.x }}, {{ lab.coordinates.y }}</td>
            </ng-container>

            <!-- Discipline -->
            <ng-container matColumnDef="discipline">
                <th mat-header-cell *matHeaderCellDef>Дисциплина</th>
                <td mat-cell *matCellDef="let lab">{{ getDisciplineText(lab) }}</td>
            </ng-container>

            <!-- Created -->
            <ng-container matColumnDef="creationDate">
                <th mat-header-cell *matHeaderCellDef class="sortable" (click)="toggleSort('creationdate')">
                    Создано
                    <span class="sort-indicator" *ngIf="getSortDirection('creationdate')">
                        <mat-icon>{{ getSortDirection('creationdate') === 'desc' ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
                        <span class="sort-index" *ngIf="sorts.length > 1">{{ getSortIndex('creationdate') + 1 }}</span>
                    </span>
                </th>
                <td mat-cell *matCellDef="let lab">{{ formatDate(lab.creationDate) }}</td>
            </ng-container>

            <!-- Actions -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Действия</th>
                <td mat-cell *matCellDef="let lab">
                    <button mat-stroked-button color="primary" type="button"
                        (click)="onEditClick(lab, $event)">Редактировать</button>
                    <button mat-stroked-button color="warn" type="button"
                        (click)="onDeleteClick(lab.id, $event)">Удалить</button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)"></tr>
        </table>
    </ng-template>
</section>