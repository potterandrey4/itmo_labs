<section>
    <h2 *ngIf="dialogMode" mat-dialog-title>
        {{ selected ? 'Редактировать лабораторную работу' : 'Новая лабораторная работа' }}
    </h2>

    <header *ngIf="!dialogMode">
        <h2>{{ selected ? 'Редактировать' : 'Создать' }} лабораторную работу</h2>
    </header>

    <ng-template #formTemplate>
        <form #formRef="ngForm" (ngSubmit)="onSubmit(formRef)" class="mat-form">
            <div class="form-row">
                <mat-form-field appearance="outline" class="app-field">
                    <mat-label>Название</mat-label>
                    <input matInput [(ngModel)]="form.name" name="name" required />
                    <mat-error *ngIf="errors.name">{{ errors.name }}</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="app-field"
                    [class.mat-form-field-invalid]="errors.coordinates?.x">
                    <mat-label>X координата</mat-label>
                    <input matInput [(ngModel)]="form.coordinates.x" name="coordX" type="text" required
                        (input)="onInputX($event)" (blur)="onBlurX(coordXInput)" #coordXInput="ngModel" />
                    <mat-error *ngIf="errors.coordinates?.x">{{ errors.coordinates!.x }}</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="app-field"
                    [class.mat-form-field-invalid]="errors.coordinates?.y">
                    <mat-label>Y координата</mat-label>
                    <input matInput [(ngModel)]="form.coordinates.y" name="coordY" type="text" required
                        (input)="onInputY($event)" (blur)="onBlurY(coordYInput)" #coordYInput="ngModel" />
                    <mat-error *ngIf="errors.coordinates?.y">{{ errors.coordinates!.y }}</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="app-field"
                    [class.mat-form-field-invalid]="errors.minimalPoint">
                    <mat-label>Минимальный балл</mat-label>
                    <input matInput [(ngModel)]="form.minimalPoint" name="minimalPoint" type="text" required
                        (input)="onInputMinimalPoint($event)" (blur)="onBlurMinimalPoint(minimalPointInput)"
                        #minimalPointInput="ngModel" />
                    <mat-error *ngIf="errors.minimalPoint">{{ errors.minimalPoint }}</mat-error>
                </mat-form-field>
            </div>

            <div class="form-row">
                <mat-form-field appearance="outline" class="app-field">
                    <mat-label>Личностные качества (макс)</mat-label>
                    <input matInput [(ngModel)]="form.personalQualitiesMaximum" name="pqMax" type="text"
                        (input)="onInputPersonalQualities($event)" />
                    <mat-error *ngIf="errors.personalQualitiesMaximum">{{ errors.personalQualitiesMaximum }}</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="app-field">
                    <mat-label>Сложность</mat-label>
                    <mat-select [(ngModel)]="form.difficulty" name="difficulty" required>
                        <mat-option *ngFor="let diff of difficulties" [value]="diff">
                            {{ difficultyLabels[diff] }}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="errors.difficulty">{{ errors.difficulty }}</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="app-field">
                    <mat-label>Дисциплина *</mat-label>
                    <mat-select [(ngModel)]="form.disciplineId" name="disciplineId" placeholder="Выберите дисциплину">
                        <mat-option *ngFor="let disc of disciplines" [value]="disc.id">
                            {{ disc.name }}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="errors.disciplineId">{{ errors.disciplineId }}</mat-error>
                </mat-form-field>
            </div>

            <div class="form-actions" *ngIf="!dialogMode">
                <button mat-raised-button color="primary" type="submit" [disabled]="busy">
                    {{ busy ? 'Сохранение...' : (selected ? 'Обновить' : 'Создать') }}
                </button>
                <button mat-stroked-button color="warn" *ngIf="selected" (click)="onDeleteClick()" type="button">
                    Удалить
                </button>
            </div>
        </form>
    </ng-template>

    <ng-container *ngIf="dialogMode; else inline">
        <mat-dialog-content class="dialog-content">
            <ng-container *ngTemplateOutlet="formTemplate"></ng-container>
        </mat-dialog-content>
    </ng-container>

    <ng-template #inline>
        <ng-container *ngTemplateOutlet="formTemplate"></ng-container>
    </ng-template>

    <mat-dialog-actions *ngIf="dialogMode" align="end">
        <button mat-button (click)="dialogRef?.close()">Отмена</button>
        <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="busy">
            {{ busy ? 'Сохранение...' : (selected ? 'Обновить' : 'Создать') }}
        </button>
    </mat-dialog-actions>
</section>